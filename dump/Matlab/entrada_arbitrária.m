close all; clc; clear all;

K=0.169022678510371;
Ti=0.072109163345392;
Td=0.091354695916176;
N=5;
Tf=Td/N;

zeta = 0.900733958553509;
wn=8.036118730219977;
k=1;
t=0:0.005:5;

s=tf('s');

%sistemas
M=(wn^2)/(s^2+2*zeta*wn*s+wn^2);
P=K*(1+(1/(Ti*s))+(Td*s/(1+Tf*s)));
malha_fechada=(P*M)/(1+P*M);

tecido_corrigido = [0
4.158
42.15
146.88
295.908
436.854
537.09
587.91
602.526
602.394
597.6
588.702
579.828
573.354
566.85
564.858
569.43
576.162
582.666
583.854
579.066
575.178
576.18
578.922
578.88
576.312
575.466
577.644
578.406
577.68
580.002
582.954
582.6
580.284
577.086
573.702
571.842
573.888
579.762
584.244
582.096
577.788
579.294
583.488
584.19
582.576
583.206
585.288
582.558
576.504
574.17
577.464
581.508];

carro=[0
0
0
0
0
2.62
18.68
63.17
141.91
244.92
350.55
439.72
505.35
548.24
572.77
584.67
588.66
588.31
586.26
584.06
581.87
579.75
578.76
579.02
579.73
580.43
580.95
581.24
581.36
581.38
581.36
581.32
581.28
581.78
582.89
583.43
583.06
582.42
581.84
581.44
581.22
581.14
581.66
582.81
583.39
583.57
584.59
585.68
585.98
585.87
585.1
583.75
583.03]

tecido_corrigido = tecido_corrigido';
t=0:0.1:(length(tecido_corrigido)*0.1)-0.1;
[simulado,t,x]=lsim(malha_fechada,tecido_corrigido,t);
%%
plot(t,tecido_corrigido,'-k','LineWidth',1.5);
hold on
plot(t,simulado,'-r','LineWidth',1.5);
plot(t,carro,'-b','LineWidth',1.5);
grid on
grid minor
legend('Sewing Machine Speed (Input)','Simulated Response','Real Response');

